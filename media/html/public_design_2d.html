{% extends "media/html/_public.html" %}

{% block head%}
  <meta http-equiv="cache-control" content="no-cache"/>
  <meta http-equiv="pragma" content="no-cache"/>
{% endblock %}

{% block content %}
  <div class="col-md-12">
    <h2>
      Input Data:
      <code class="pull-right">Mutate-and-Map Plates</code>
    </h2>
  </div>
  <form method='post' action='/design_2d_run/' id='form_2d'>
    {% csrf_token %}
    <div class="row">
      <div class="col-md-9">
       <div style="padding-bottom:15px;" data-toggle="tooltip" data-placement="bottom" title="Construct name prefix for all primers; maximum length 32 characters.">
        <label for="tag" class="col-md-3">
          <span class="glyphicon glyphicon-tag"></span>&nbsp;&nbsp;<b>Name Tag</b>:&nbsp;&nbsp;
        </label>
        <div class="input-group col-md-6">
          {{2d_form.tag}}
          <span class="input-group-addon"><i>optional</i></span>
        </div>
       </div>

       <div class="row bgimg">
        <div class="col-md-6">
          <label for="sequence" class="col-md-12">
            <span class="glyphicon glyphicon-cd"></span>&nbsp;&nbsp;<b>Sequence</b>:
          </label>
          <div class="col-md-12">
           <ul>
            <li>Please enter your sequence below: valid nucleotides only (A, C, G, T, and U); and <u>at least <b>60</b> nt</u> long.</li>
            <li>Flanking sequences (e.g. T7 promoter, buffering region, tail) should be included. Please make sure the sequence matches exactly as in <code>Single Assembly</code>.</li>
           </ul>
          </div>
        </div>
        <div class="col-md-6">
          <label for="sequence" class="col-md-12">
            <span class="glyphicon glyphicon-indent-left"></span>&nbsp;&nbsp;<b>Primers</b>:
          </label>
          <div class="col-md-12">
           <ul>
            <li>Please enter your primer set from <code>Single Assembly</code> below. Please make sure the primer numberings match the previous result.</li>
            <li>Click "Add Primers" to add more primer pairs.</li>
           </ul>
          </div>
         <p class="text-right">
          <i>Length: <b><span id="count"></span></b> nt</i>
         </p>
        </div>
       </div>
       <div class="row">
        <div class="col-md-6">
          {{2d_form.sequence}}
        </div>
        <div class="col-md-6">
          {{2d_form.primers}}
          <div id="primer_sets">
            <div style="padding-bottom:10px;" id="primer_1" class="input-group">
              <span class="input-group-addon">
                <b>1</b>
                <span class="label label-info">F</span>
              </span>
              <input class="primer_input form-control" type="text" id="id_primer_1" name="id_primer_1"/>
            </div>
            <div style="padding-bottom:10px;" id="primer_2" class="input-group">
              <span class="input-group-addon">
                <b>2</b>
                <span class="label label-danger">R</span>
              </span>
              <input class="primer_input form-control" type="text" id="id_primer_2" name="id_primer_2"/>
            </div>
            <div style="padding-bottom:10px;" id="primer_3" class="input-group">
              <span class="input-group-addon">
                <b>3</b>
                <span class="label label-info">F</span>
              </span>
              <input class="primer_input form-control" type="text" id="id_primer_3" name="id_primer_3"/>
            </div>
            <div style="padding-bottom:10px;" id="primer_4" class="input-group">
              <span class="input-group-addon">
                <b>4</b>
                <span class="label label-danger">R</span>
              </span>
              <input class="primer_input form-control" type="text" id="id_primer_4" name="id_primer_4"/>
            </div>

          </div>
          <a class="btn btn-warning" id="btn-add">&nbsp;Add Primers&nbsp;</a>
        </div>
       </div>
       <br/>

       <input name="job_id"  id="job_id" type="text" style="display:none" value="" />
      </div>
      <div class="col-md-3">
        <div class="panel panel-default">
          <div class="panel-heading" data-toggle="tooltip" data-placement="left" title="More options for guided design. Parameters for primer length, primer number and annealing temperature can be specified.">
            <h3 class="panel-title"><span class="glyphicon glyphicon-wrench"></span>&nbsp;&nbsp;Advanced Options</h3>
          </div>
          <div class="panel-body">
            <div class="input-group">
              <div data-toggle="tooltip" data-placement="left" title="Minimum annealing temperature for overlapping regions. Default = 60.0 &deg;C">
                <label for="offset">sequence <b>offset</b>:</label>
                <div class="input-group" style="margin-left:10px;">
                  {{2d_form.offset}}
                  <span class="input-group-addon">nt</span>
                </div>
              </div>
              <div style="padding-top: 10px;" data-toggle="tooltip" data-placement="left" title="Maximum length for each primer. Default = 60 nt.">
                <label for="min_mut">mutation <b>starting</b> position:</label>
                <div class="input-group" style="margin-left:10px;">
                  <span class="input-group-addon">@</span>
                  {{2d_form.min_muts}}
                  <span class="input-group-addon">nt</span>
                </div>
              </div>
              <div style="padding-top: 10px;" data-toggle="tooltip" data-placement="left" title="Minimum length for each primer. Default = 15 nt.">
                <label for="max_mut">mutation <b>ending</b> position:</label>
                <div class="input-group" style="margin-left:10px;">
                  <span class="input-group-addon">@</span>
                  {{2d_form.max_muts}}
                  <span class="input-group-addon">nt</span>
                </div>
              </div>
              <div style="padding-top: 10px;" data-toggle="tooltip" data-placement="left" title="Exact limit of number of primers in design. Default = 0, i.e. no restriction; solutions have less or more number of primers will not be shown. Even number only." >
                <label for="max_mut">mutation <b>library</b> choice:</label>
                <div class="input-group" style="margin-left:10px;">
                  {{2d_form.lib}}
                </div>
              </div>
            </div>
          </div>
        </div>
       <div class="row">
        <div class="col-md-12">
          <input type="submit" class="btn btn-primary pull-left" id="btn_submit" value="&nbsp;Primerize!&nbsp;"/>&nbsp;
          <a class="btn btn-default" href="/design_2d/">&nbsp;&nbsp;Clear&nbsp;&nbsp;</a>&nbsp;
          <a id="btn_demo" class="btn btn-success pull-right" href="/demo_2d_run/" data-toggle="tooltip" data-placement="bottom" title="Example primer design using P4P6-2HP RNA.">
          &nbsp;&nbsp;Demo&nbsp;&nbsp;</a>
         </div>
       </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-9">
        <div class="alert alert-warning center-block" id="warn_500">
          <span class="glyphicon glyphicon-exclamation-sign"></span>&nbsp;&nbsp;<b>WARNING</b>: Your sequence is longer than <u><b>500</b> nt</u>. The runtime exhibits quadratic growth with sequence length. Please make sure you have the <span class="label label-violet">JOB_ID</span> written down for retrieval.
        </div>
        <div class="alert alert-orange center-block" id="warn_1000">
          <span class="glyphicon glyphicon-exclamation-sign"></span>&nbsp;&nbsp;<b>WARNING</b>: Your sequence is longer than <u><b>1000</b> nt</u>. The runtime exhibits quadratic growth with sequence length. For long inputs, we encourage the user to <a class="btn btn-info btn-sm" href="/license" role="button" style="color: #ffffff;">&nbsp;&nbsp;Download&nbsp;&nbsp;</a> the source code and run locally, which enables more options. 
        </div>
      </div>
      <div class="col-md-3"></div>
    </div>

  </form>
  <div id="result"></div>
 {% endblock %}

{% block script %}
  <script type="text/javascript">
    if (isCDN) {
      document.write('<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/zeroclipboard/' + ver_zclip + '/ZeroClipboard.min.js"><\/script>');
    } else {
      document.write('<script type="text/javascript" src="/site_media/js/ZeroClipboard.min.js"><\/script>');
    }
  </script>
  <script type="text/javascript" src="/site_media/js/public/{{DEBUG_DIR}}design_2d{{DEBUG_STR}}.js"></script>  
  {% if result_job_id %}
    <script type="text/javascript">
      var job_id = "{{result_job_id}}";
      ajax_load_html(job_id);
      ajax_timeout = setInterval(function() {
        if ($("#result").html().indexOf("Primerize is running") == -1) {
          clearInterval(ajax_timeout);
        } else {
          ajax_load_html(job_id);
        }
      }, 1500);
    </script>
  {% endif %}
{% endblock %}

