{% extends "admin/base.html" %}
{% load i18n admin_static %}

{% block content %}
<div id="content-main" class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
  <div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
      <div class="jumbotron">
        <div class="container">
          <h1>Primerize Admin Reference</h1>
          <img src="/site_media/images/logo_primerize.png" style="clear:both; float:right; padding-left: 20px;"/>
          <p>
            This page explains server setup and code structure in detail.
          </p>
          <br/>
          <h5>by <i>t47</i>, Apr 2016</h5>
        </div>
      </div>
    </div>
  </div>

  <hr/>
  <div class="row">
    <div class="col-lg-3 col-md-3 hidden-sm hidden-xs" id="side">
      <div id="side_con">
        <div class="panel panel-success" id="sidebar">
          <div class="panel-heading">
            <h3 class="panel-title"><span class="glyphicon glyphicon-th-large"></span>&nbsp;&nbsp;Sections</h3>
          </div>
          <div class="panel-body scroll_nav">
            <ul class="nav" role="tablist" id="scroll_nav">
              <li class="li-info">
                <a id="tab_1" href="#overview">
                  <span class="glyphicon glyphicon-dashboard"></span>&nbsp;&nbsp;Section #1: 
                  <b>Overview</b>
                  <span class="glyphicon pull-right glyphicon-triangle-bottom" data-toggle="collapse" data-parent="#accordion" href="#collapse_tab_1" aria-expanded="true" aria-controls="collapse_tab_1"></span>
                </a>
                <ul id="collapse_tab_1" class="panel-collapse collapse nav" role="tabpanel" aria-labelledby="collapse_tab_1">
                  <li><a id="tab_11" href="#arch">&nbsp;&nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-home"></span>&nbsp;&nbsp;Architecture</a></li>
                  <li><a id="tab_12" href="#django">&nbsp;&nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-phone"></span>&nbsp;&nbsp;Django App</a></li>
                </ul>
              </li>
              <li class="li-danger">
                <a id="tab_2" href="#linux">
                  <span class="glyphicon glyphicon-road"></span>&nbsp;&nbsp;Section #2: 
                  <b>Linux</b>
                  <span class="glyphicon pull-right glyphicon-triangle-bottom" data-toggle="collapse" data-parent="#accordion" href="#collapse_tab_2" aria-expanded="true" aria-controls="collapse_tab_2"></span>
                </a>
                <ul id="collapse_tab_2" class="panel-collapse collapse nav" role="tabpanel" aria-labelledby="collapse_tab_2">
                  <li><a id="tab_21" href="#linux_aws">&nbsp;&nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-text-background"></span>&nbsp;&nbsp;AWS Setup</a></li>
                  <li><a id="tab_22" href="#linux_cmd">&nbsp;&nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-hdd"></span>&nbsp;&nbsp;Local Setup</a></li>
                </ul>
              </li>
              <li class="li-green">
                <a id="tab_3" href="#apache">
                  <span class="glyphicon glyphicon-grain"></span>&nbsp;&nbsp;Section #3: 
                  <b>Apache</b>
                </a>
              </li>
              <li class="li-warning">
                <a id="tab_4" href="#mysql">
                  <span class="glyphicon glyphicon-oil"></span>&nbsp;&nbsp;Section #4: 
                  <b>MySQL</b>
                </a>
              </li>
              <li class="li-violet">
                <a id="tab_5" href="#python">
                  <span class="glyphicon glyphicon-tent"></span>&nbsp;&nbsp;Section #5: 
                  <b>Python</b>
                  <span class="glyphicon pull-right glyphicon-triangle-bottom" data-toggle="collapse" data-parent="#accordion" href="#collapse_tab_5" aria-expanded="true" aria-controls="collapse_tab_5"></span>
                </a>
                <ul id="collapse_tab_5" class="panel-collapse collapse nav" role="tabpanel" aria-labelledby="collapse_tab_5">
                  <li><a id="tab_51" href="#python_root">&nbsp;&nbsp;&nbsp;&nbsp;<span class="code code_path">/</span></a></li>
                  <li><a id="tab_52" href="#python_backup">&nbsp;&nbsp;&nbsp;&nbsp;<span class="code code_path">backup/</span></a></li>
                  <li><a id="tab_53" href="#python_cache">&nbsp;&nbsp;&nbsp;&nbsp;<span class="code code_path">cache/</span></a></li>
                  <li><a id="tab_54" href="#python_config">&nbsp;&nbsp;&nbsp;&nbsp;<span class="code code_path">config/</span></a></li>
                  <li><a id="tab_55" href="#python_data">&nbsp;&nbsp;&nbsp;&nbsp;<span class="code code_path">data/</span></a></li>
                  <li><a id="tab_56" href="#python_dist">&nbsp;&nbsp;&nbsp;&nbsp;<span class="code code_path">dist/</span></a></li>
                  <li>
                    <a id="tab_57" href="#python_media">&nbsp;&nbsp;&nbsp;&nbsp;<span class="code code_path">media/</span></a>
                    <ul style="padding-left:60px;">
                      <li><a id="tab_571" href="#python_js"><span class="code code_path">media/js/</span></a></li>
                    </ul>
                  </li>
                  <li>
                    <a id="tab_58" href="#python_src">&nbsp;&nbsp;&nbsp;&nbsp;<span class="code code_path">src/</span></a>
                    <ul style="padding-left:60px;">
                      <li><a id="tab_581" href="#src_admin"><span class="code code_path">src/admin.py</span></a></li>
                      <li><a id="tab_582" href="#src_console"><span class="code code_path">src/console.py</span></a></li>
                      <li><a id="tab_583" href="#src_env"><span class="code code_path">src/env.py</span></a></li>
                      <li><a id="tab_584" href="#src_views"><span class="code code_path">src/views.py</span></a></li>
                    </ul>
                  </li>
                  <li><a id="tab_59" href="#python_wrap">&nbsp;&nbsp;&nbsp;&nbsp;<span class="code code_path">src/wrapper_?d.py</span></a></li>
                  <li><a id="tab_50" href="#man_cmd">&nbsp;&nbsp;&nbsp;&nbsp;<span class="code code_path">src/management/commands/</span></a></li>
                </ul>
              </li>

            </ul>
          </div>
        </div>
      </div>
    </div>


    <div class="pull-right col-lg-9 col-md-9 col-sm-12 col-xs-12" id="main">
      <div class="container-fluid li-info" role="main">
        <div class="panel-info" id="overview">
          <div class="panel-heading">
            <span class="lead">
              <span class="glyphicon glyphicon-dashboard"></span>&nbsp;&nbsp;<b><span class="sec">Section</span> <span class="num">#1</span>: Overview</b>
            </span>
          </div>
          <br/>
          <div class="row" id="arch">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 30px;">
              <h4><span class="glyphicon glyphicon-home"></span>&nbsp;&nbsp;Server Architecture</h4>
              <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">
                  <p>HTTP <span class="code code_method">Request</span> from internet</p>
                  <span class="glyphicon glyphicon-arrow-down"></span>
                  <p>Stanford <b>NetDB</b> alias (<span class="code code_url">primerize.stanford.edu</span>)</p>
                  <span class="glyphicon glyphicon-arrow-down"></span>
                  <p><span class="code code_brand">AWS</span> <span class="code code_misc">ELB</span> (<span class="code code_url">primerize-balancer-1516867550.us-west-2.elb.amazonaws.com</span>)</p>
                  <span class="glyphicon glyphicon-arrow-down"></span>
                  <p><span class="code code_brand">AWS</span> <span class="code code_misc">EC2</span> (<span class="code code_url">ec2-52-33-204-5.us-west-2.compute.amazonaws.com</span>)</p>
                  <span class="glyphicon glyphicon-arrow-down"></span>
                  <p><span class="code code_brand">Apache</span> reverse proxy (<b>port</b> <span class="code code_val">443</span>)</p>
                  <span class="glyphicon glyphicon-arrow-down"></span>
                  <p><span class="code code_brand">Apache</span> <span class="code code_misc">WSGI</span> worker</p>
                  <span class="glyphicon glyphicon-arrow-down"></span>
                  <p style="padding-left:125px;">
                    <span class="code code_cmd">python</span> <span class="code code_misc">Django</span> App
                    &nbsp;&nbsp;<span class="glyphicon glyphicon-transfer"></span>&nbsp;&nbsp;
                    <span class="code code_brand">MySQL</span> database
                  </p>
                  <span class="glyphicon glyphicon-arrow-down"></span>
                  <p>HTTP <span class="code code_method">Response</span> to client</p>
                </div>
              </div>
            </div>
          </div>

          <hr/>
          <div class="row" id="django">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 30px;">
              <h4><span class="glyphicon glyphicon-phone"></span>&nbsp;&nbsp;<span class="code code_misc">Django</span> App</h4>
              <br/>
              <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                  <img src="/admin/get_arch/" alt="Server Architecture" width="100%" class="thumbnail" />
                </div>
              </div>

              <div class="row">
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                  <p>
                    <span class="code code_brand">Apache</span>
                    &nbsp;&nbsp;<span class="glyphicon glyphicon-transfer"></span>&nbsp;&nbsp;
                    <span class="code code_path">wsgi.py</span>
                  </p>
                  <p>
                    <span class="code code_brand">MySQL</span>
                    &nbsp;&nbsp;<span class="glyphicon glyphicon-transfer"></span>&nbsp;&nbsp;
                    <span class="code code_path">models.py</span>
                  </p>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <p>&nbsp;</p>
                  <p>HTTP <span class="code code_method">Request</span></p>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3"></div>
              </div>
              <br/>
              <div class="row" style="padding-bottom:5px;">
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
                  App initiation
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="code code_path">user.py</span>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="glyphicon glyphicon-arrow-down"></span>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3"></div>
              </div>

              <div class="row" style="padding-bottom:5px;">
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center"></div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="code code_path">admin.py</span>
                  <span class="glyphicon glyphicon-arrow-left pull-right"></span>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="code code_path">urls.py</span>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="code code_path">helper.py</span>
                </div>
              </div>
              <div class="row" style="padding-bottom:5px;">
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center"></div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="glyphicon glyphicon-arrow-down"></span>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="glyphicon glyphicon-sort"></span>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="glyphicon glyphicon-arrow-up"></span>
                </div>
              </div>
              <div class="row" style="padding-bottom:5px;">
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="code code_path">settings.py</span>
                  <span class="glyphicon glyphicon-transfer pull-right"></span>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="code code_path">console.py</span>
                  <span class="glyphicon glyphicon-arrow-left pull-right"></span>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="code code_path">views.py</span>
                  <span class="glyphicon glyphicon-arrow-right pull-right"></span>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="code code_path">wrapper_1d.py</span>
                </div>
              </div>
              <div class="row" style="padding-bottom:5px;">
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="glyphicon glyphicon-arrow-down"></span>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="glyphicon glyphicon-arrow-down"></span>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center"></div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="code code_path">wrapper_2d.py</span>
                </div>
              </div>
              <div class="row" style="padding-bottom:5px;">
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="code code_path">env.py</span>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="glyphicon glyphicon-arrow-left pull-right"></span>
                  <span class="code code_cmd">gdrive</span>
                  <br/>
                  <span class="code code_misc">cron</span> job
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="code code_path">gdrive.py</span> job
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-center">
                  <span class="code code_path">wrapper_3d.py</span>
                </div>
              </div>

              <br/>
              <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th class="col-lg-2 col-md-2 col-sm-3 col-xs-3"><span class="glyphicon glyphicon-folder-open"></span>&nbsp;&nbsp; Path</th>
                      <th class="col-lg-3 col-md-3 col-sm-4 col-xs-4"></th>
                      <th class="col-lg-7 col-md-7 col-sm-5 col-xs-5"><span class="glyphicon glyphicon-tag"></span>&nbsp;&nbsp; Description</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td colspan="2"><span class="code code_path">backup/</span></td>
                      <td>Backup <span class="code code_spe">*.tgz</span> files.</td>
                    </tr>
                    <tr>
                      <td colspan="2"><span class="code code_path">cache/</span></td>
                      <td>System log files and cached system status <span class="code code_key">JSON</span> files.</td>
                    </tr>
                    <tr>
                      <td colspan="2"><span class="code code_path">config/</span></td>
                      <td>Configuration <span class="code code_spe">*.conf</span> server secrets, and flow chart.</td>
                    </tr>
                    <tr>
                      <td colspan="2"><span class="code code_path">data/</span></td>
                      <td>Job results <span class="code code_spe">*.html</span> for display, <span class="code code_spe">*.zip</span> for download, and <span class="code code_spe">*.json</span> for plate rendering. Subcategorized into <span class="code code_path">1d/</span>, <span class="code code_path">2d/</span>, and <span class="code code_path">3d/</span>. This folder is accessible through url <span class="code code_url">/site_data/</span>.</td>
                    </tr>
                    <tr>
                      <td colspan="2"><span class="code code_path">dist/</span></td>
                      <td>Distribution of <code>primerize</code> package releases and master branch, and a <span class="code code_path">LICENSE.md</span> for license display.</td>
                    </tr>
                    <tr>
                      <td colspan="2"><span class="code code_path">media/</span></td>
                      <td>Static assets for front-end. This folder is accessible through url <span class="code code_url">/site_media/</span>.</td>
                    </tr>
                    <tr>
                      <td></td>
                      <td><span class="code code_path">admin/</span></td>
                      <td>Admin related <span class="code code_key">HTML</span> and others.</td>
                    </tr>
                    <tr>
                      <td></td>
                      <td><span class="code code_path">css/</span></td>
                      <td><span class="code code_key">CSS</span> styling files.</td>
                    </tr>
                    <tr>
                      <td></td>
                      <td><span class="code code_path">fonts/</span></td>
                      <td><span class="code code_misc">Glyphicon</span> and <span class="code code_spe">Helvetica</span> font resource.</td>
                    </tr>
                    <tr>
                      <td></td>
                      <td><span class="code code_path">html/</span></td>
                      <td>Public and admin <span class="code code_key">HTML</span> templates.</td>
                    </tr>
                    <tr>
                      <td></td>
                      <td><span class="code code_path">images/</span></td>
                      <td>Public image files, contains sprites.</td>
                    </tr>
                    <tr>
                      <td></td>
                      <td><span class="code code_path">js/</span></td>
                      <td>Public and admin <span class="code code_misc">Javascript</span> files. Subcategorized into <span class="code code_path">admin/</span>, <span class="code code_path">public/</span> and <span class="code code_path">suit/</span>.</td>
                    </tr>
                    <tr>
                      <td colspan="2"><span class="code code_path">src/</span></td>
                      <td><span class="code code_cmd">python</span> back-end scripts.</td>
                    </tr>
                    <tr>
                      <td></td>
                      <td><span class="code code_path">management/commands/</span></td>
                      <td><span class="code code_misc">Django</span> management command scripts.</td>
                    </tr>
                    <tr>
                      <td colspan="2"><span class="code code_path">*.sh</span></td>
                      <td><span class="code code_cmd">bash</span> commands for multiple server tasks (supplementing <span class="code code_misc">Django</span> management commands).</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

        </div>
      </div>

      <hr/>
      <div class="container-fluid li-danger" role="main">
        <div class="panel-danger" id="linux">
          <div class="panel-heading">
            <span class="lead">
              <span class="glyphicon glyphicon-road"></span>&nbsp;&nbsp;<b><span class="sec">Section</span> <span class="num">#2</span>: Linux</b>
            </span>
          </div>
          <br/>
          <div class="row" id="linux_aws">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 30px;">
              <h4><span class="glyphicon glyphicon-text-background"></span>&nbsp;&nbsp;<span class="code code_brand">AWS</span> Setup</h4>
              <p>The server is an <span class="code code_misc">EC2</span> instance with <span class="code code_misc">ELB</span> at <span class="code code_brand">AWS</span>. Essential setup is listed as below:</p>
              <ul>
                <li><span class="code code_misc">EC2</span> instance with <span class="code code_brand">Ubuntu</span> <u>14.04 LTS</u>. <span class="code code_misc">EBS</span> drive is mount to <span class="code code_path">/dev/sda1</span>.</li>
                <li>Use the following <b>Security Groups</b>: <span class="code code_key">HTTP &amp; SSH</span> (opens port <u>80</u> and port <u>22</u>), <span class="code code_key">HTTPS</span> (opens port <u>443</u>).</li>
                <li>Submit <span class="code code_misc">SSL Certificate</span> through <span class="code code_cmd">aws iam</span>. See <a href="http://docs.aws.amazon.com/ElasticLoadBalancing/latest/DeveloperGuide/ssl-server-cert.html" target="_blank">here&nbsp;&nbsp;<span class="glyphicon glyphicon-new-window"></span></a>. Use the <span class="code code_misc">SSL Certificate</span> for <span class="code code_val">443</span> forwarding protocol.</li>
                <li>Add instance to <span class="code code_misc">ELB</span>, configure with port forwarding <span class="code code_val">80</span> to <u>80</u>, <span class="code code_val">443</span> to <u>443</u>. Use same <b>Security Groups</b> as <span class="code code_misc">EC2</span>.</li>
                <li>Set <span class="code code_misc">ELB</span> <b>Health Check</b> to address <span class="code code_url">HTTPS:443/ping_test/</span>, with interval <u>180 s</u> and timeout <u>15 s</u>.</li>
              </ul>
              <p>Once done, you can access the server via <span class="code code_cmd">ssh</span>. Use the server's <b>Public IP</b> address, instead of <b>Private IP</b>. <span class="code code_brand">AWS</span> <span class="code code_misc">EC2</span> are configured to use a certificate for authentication, not password (In fact, user <span class="code code_val">ubuntu</span> has no password). Use <span class="code code_cmd">-i</span> to supply the certificate.</p>
            </div>
          </div>

          <hr/>
          <div class="row" id="linux_cmd">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 30px;">
              <h4><span class="glyphicon glyphicon-hdd"></span>&nbsp;&nbsp;Local Setup</h4>
              <p>First, set up <span class="code code_cmd">llvm</span>, which is used by <code>llvmlite</code> and <code>numba</code> that accelerates <code>primerize</code> <i>for loops</i>. Create a <span class="code code_path">/etc/apt/sources.list.d/llvm.list</span> file with the following content:</p>
<pre>
deb http://llvm.org/apt/trusty/ llvm-toolchain-trusty main
deb-src http://llvm.org/apt/trusty/ llvm-toolchain-trusty main
# 3.6 
deb http://llvm.org/apt/trusty/ llvm-toolchain-trusty-3.6 main
deb-src http://llvm.org/apt/trusty/ llvm-toolchain-trusty-3.6 main  
</pre>
              <p>Now you can use <span class="code code_cmd">apt-get</span> to install <span class="code code_cmd">llvm</span>. Due to the complicated compatibility issues between <span class="code code_cmd">llvm</span>, which is used by <code>llvmlite</code> and <code>numba</code>, we stick with:</p>
<pre style="width:50%;">
<span class="code code_cmd">llvm</span> == <span class="code code_val">3.6.2</span>
<span class="code code_spe">llvmlite</span> == <span class="code code_val">0.8.0</span>
<span class="code code_spe">numba</span> == <span class="code code_val">0.23.1</span>
</pre>
              <p>These packages are excluded from <span class="code code_cmd">upd</span> command so you won't accidentally update them. In the far future, if this combination has components that are out of support, updating all into newer (still compatible with each other) versions should be carried out.</p>
              <br/>

              <p>Second, you need to install <span class="code code_cmd">gdrive</span> for <span class="code code_brand">Google Drive</span> connections. You can retrieve from the <span class="code code_path">backup/backup_config.tgz</span>, or download <a href="https://github.com/prasmussen/gdrive" target="_blank">here&nbsp;&nbsp;<span class="glyphicon glyphicon-new-window"></span></a>.</p>
              <br/>
              <p>Commonly used commands are provided as aliases for shortcut. They are defined in <span class="code code_path">/home/ubuntu/.bash_profile</span>.</p>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td><span class="code code_cmd">upd</span></td><td>Updates <span class="code code_cmd">apt-get</span> and <span class="code code_cmd">pip</span> packages, cleans up old packages, and runs <span class="code code_cmd">dj_man versions</span>. Afterwards, make sure <span class="code code_brand">Apache</span> is running with <span class="code code_misc">worker</span>, NOT <span class="code code_misc">prefork</span>!</td></tr>
                      <tr><td><span class="code code_cmd">sync</span></td><td>Complete procedure for updating server code: pulls repository, runs <span class="code code_path">util_minify.sh</span>, <span class="code code_path">util_sys_asset.sh</span>, <span class="code code_path">util_chmod.sh</span>, and restarts <span class="code code_brand">Apache</span> server.</td></tr>
                      <tr><td><span class="code code_cmd">a2rs</span></td><td>Restarts <span class="code code_brand">Apache</span> server.</td></tr>
                      <tr><td><span class="code code_cmd">swap_on</span>, <span class="code code_cmd">swap_off</span></td><td>Toggle <u>2 GB</u> of memory swap. Use upon restart of the server.</td></tr>
                      <tr><td><span class="code code_cmd">dj_man</span></td><td>Shortcut for <span class="code code_misc">Django</span> management commands.</td></tr>
                      <tr><td><span class="code code_cmd">dj_cron</span></td><td>Shortcut for <span class="code code_cmd">crontab</span> of <span class="code code_val">www-data</span> user.</td></tr>
                      <tr><td><span class="code code_cmd">cl_a2a</span>, <span class="code code_cmd">cl_a2e</span></td><td>Show log of <span class="code code_brand">Apache</span> access / error.</td></tr>
                      <tr><td><span class="code code_cmd">cl_cron</span></td><td>Show log of <span class="code code_cmd">crontab</span>.</td></tr>
                      <tr><td><span class="code code_cmd">cl_dj</span></td><td>Show log of <span class="code code_misc">Django</span>.</td></tr>
                      <tr><td colspan="2" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <hr/>
      <div class="container-fluid li-green" role="main">
        <div class="panel-green" id="apache">
          <div class="panel-heading">
            <span class="lead">
              <span class="glyphicon glyphicon-grain"></span>&nbsp;&nbsp;<b><span class="sec">Section</span> <span class="num">#3</span>: Apache</b>
            </span>
          </div>
          <br/>
          <div class="row" id="apache_config">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 30px;">
              <ul>
                <li>Install <span class="code code_misc">mod_wsgi</span> and <span class="code code_misc">mod_xsendfile</span> through <span class="code code_cmd">apt-get</span>.</li>
                <li>Have the following modules enabled (exactly): <span class="code code_val">access_compat</span>, <span class="code code_val">alias</span>, <span class="code code_val">auth_basic</span>, <span class="code code_val">authn_core</span>, <span class="code code_val">authn_file</span>, <span class="code code_val">authz_core</span>, <span class="code code_val">authz_groupfile</span>, <span class="code code_val">authz_host</span>, <span class="code code_val">authz_user</span>, <span class="code code_val">deflate</span>, <span class="code code_val">filter</span>, <span class="code code_val">mime</span>, <span class="code code_val">mpm_worker</span>, <span class="code code_val">negotiation</span>, <span class="code code_val">reqtimeout</span>, <span class="code code_val">setenvif</span>, <span class="code code_val">socache_shmcb</span>, <span class="code code_val">ssl</span>, <span class="code code_val">status</span>, <span class="code code_val">wsgi</span>, <span class="code code_val">xsendfile</span>.</li>
                <li>Edit configuration files. It's recommend to recover and overwrite from the <span class="code code_path">backup/backup_apache.tgz</span>. These files are important: <span class="code code_path">apache.conf</span>, <span class="code code_path">deflate.conf</span>, <span class="code code_path">httpd.conf</span>, <span class="code code_path">ports.conf</span>, <span class="code code_path">sites-enabled/000-default.conf</span>.</li>
              </ul>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td><span class="code code_path">httpd.conf</span></td><td>Defines <span class="code code_misc">worker</span> numbers, server status page access, error handling pages. Do not use <span class="code code_misc">prefork</span> with <span class="code code_misc">mod_wsgi</span>!</td></tr>
                      <tr><td><span class="code code_path">sites-enabled/000-default.conf</span></td><td>Sets <span class="code code_misc">SSL</span>, non-HTTPS redirects, <span class="code code_misc">xsendfile</span> path for <span class="code code_url">/tools/download/package/release/</span>, <span class="code code_misc">wsgi</span> app path, directory permissions, and <span class="code code_url">/favicon.ico</span> redirect.</td></tr>
                      <tr><td><span class="code code_path">password</span></td><td>Stores <span class="code code_brand">Apache</span> user logins. Currently only <span class="code code_val">daslab</span>.</td></tr>
                      <tr><td colspan="2" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>
              <p><span class="code code_brand">Apache</span> related system path:</p>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td>configuration</td><td><span class="code code_path">/etc/apache2/</span></td></tr>
                      <tr><td>log</td><td><span class="code code_path">/var/log/apache2/</span></td></tr>
                      <tr><td colspan="2" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <hr/>
      <div class="container-fluid li-warning" role="main">
        <div class="panel-warning" id="mysql">
          <div class="panel-heading">
            <span class="lead">
              <span class="glyphicon glyphicon-oil"></span>&nbsp;&nbsp;<b><span class="sec">Section</span> <span class="num">#4</span>: MySQL</b>
            </span>
          </div>
          <br/>
          <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 30px;">
              <ul>
                <li>Restore the database from the <span class="code code_path">backup/backup_mysql.tgz</span>, or use <span class="code code_misc">six</span> for migration. The <span class="code code_brand">MySQL</span> user is <span class="code code_spe">root</span>.</li>
                <li>Table schema are defined by <span class="code code_path">src/models.py</span>. The database is named <span class="code code_val">primerize</span>, with these tables:</li>
                <ul>
                  <li><span class="code code_val">auth_group</span>, <span class="code code_val">auth_group_permissions</span>, <span class="code code_val">auth_message</span>, <span class="code code_val">auth_permission</span>, <span class="code code_val">auth_user</span>, <span class="code code_val">auth_user_groups</span>, <span class="code code_val">auth_user_user_permissions</span></li>
                  <li><span class="code code_val">django_admin_log</span>, <span class="code code_val">django_content_type</span>, <span class="code code_val">django_flatpage</span>, <span class="code code_val">django_flatpage_sites</span>, <span class="code code_val">django_migrations</span>, <span class="code code_val">django_session</span>, <span class="code code_val">django_site</span></li>
                  <li><span class="code code_val">src_design1d</span>, <span class="code code_val">src_design2d</span>, <span class="code code_val">src_design3d</span>, <span class="code code_val">src_historyitem</span>, <span class="code code_val">src_jobgroups</span>, <span class="code code_val">src_jobids</span>, <span class="code code_val">src_sourcedownloader</span></li>
                </ul>
                <li>The <b>demo</b> entries are stored with <span class="code code_key">date</span> as <span class="code code_val">1970-01-01</span> on purpose. They will not be <span class="code code_cmd">cleanup</span>. So are their <span class="code code_key">JOB_ID</span> in the <span class="code code_val">src_jobids</span> table.</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <hr/>
      <div class="container-fluid li-violet" role="main">
        <div class="panel-violet" id="python">
          <div class="panel-heading">
            <span class="lead">
              <span class="glyphicon glyphicon-tent"></span>&nbsp;&nbsp;<b><span class="sec">Section</span> <span class="num">#5</span>: Python</b>
            </span>
          </div>
          <br/>
          <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 30px;">
              <ul>
                <li>Install <span class="code code_misc">django-filemanager</span> with the modified version (<u>0.0.2</u>). The source code are available from the <span class="code code_path">backup/backup_config.tgz</span>. The original (<u>0.0.1</u>) is <a href="https://github.com/IMGIITRoorkee/django-filemanager/" target="_blank">here&nbsp;&nbsp;<span class="glyphicon glyphicon-new-window"></span></a>.</li>
                <li>Install <span class="code code_misc">gviz-api.py</span>. The source code are available from the <span class="code code_path">backup/backup_config.tgz</span>, or download from <a href="https://github.com/google/google-visualization-python/" target="_blank">here&nbsp;&nbsp;<span class="glyphicon glyphicon-new-window"></span></a>.</li>
                <li>Other dependencies are described in <span class="code code_path">requirements.txt</span> and should be installed via <span class="code code_cmd">pip</span> system-wide.</li>
              </ul>
              <p>The following sections breaks down each directory and their contents.</p>
            </div>
          </div>

          <hr/>
          <div class="row" id="python_root">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 30px;">
              <h4><span class="code code_path">/</span> (root)</h4>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td><span class="code code_path">requirements.txt</span></td><td>Description of <span class="code code_cmd">python</span> package dependency.</td></tr>
                      <tr><td><span class="code code_path">robots.txt</span></td><td>Instruction for web crawlers. See <a href="http://www.robotstxt.org/" target="_blank">here&nbsp;&nbsp;<span class="glyphicon glyphicon-new-window"></span></a>.</td></tr>
                      <tr><td><span class="code code_path">manage.py</span></td><td><span class="code code_misc">Django</span> script entry point. <b>Do not change</b>, unless syntax changes in newer <span class="code code_misc">Django</span> releases.</td></tr>
                      <tr><td><span class="code code_path">util_chmod.sh</span></td><td>Runs <span class="code code_cmd">chmod</span> and <span class="code code_cmd">chown</span> to files and directories to set minimal required permissions. Most files are owned by <span class="code code_val">www-data</span> (the <span class="code code_brand">Apache</span> user). <span class="code code_path">config/cron.conf</span> is writable by <span class="code code_val">www-data</span>, while others are read-only. <span class="code code_spe">*.sh</span> are only accessible by <span class="code code_val">ubuntu</span>.</td></tr>
                      <tr><td><span class="code code_path">util_minify.sh</span></td><td>Minifies <span class="code code_spe">*.css</span> and <span class="code code_spe">*.js</span> files for production. Also concatenates cetain <span class="code code_spe">*.css</span> and <span class="code code_spe">*.js</span> files for fewer requests in production. Required <span class="code code_path">../yuicompressor.jar</span>.</td></tr>
                      <tr><td><span class="code code_path">util_prep_dir.sh</span></td><td>Prepares empty directories and log files for first time setup.</td></tr>
                      <tr><td><span class="code code_path">util_src_dist.sh</span></td><td>Updates the local copy of <code>primerize</code> package (at <span class="code code_path">/home/ubuntu/NA_Thermo/</span>) to latest master, and (re-)installs it system-wide.</td></tr>
                      <tr><td><span class="code code_path">util_sys_asset.sh</span></td><td>Copies over essential system settings and packages into <span class="code code_path">config/sys/</span> that will later be zipped by <span class="code code_cmd">dj_man backup</span>.</td></tr>
                      <tr><td colspan="2" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>
            </div>
          </div>

          <hr/>
          <div class="row" id="python_backup">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 30px;">
              <h4><span class="code code_path">backup/</span></h4>
              <p>Contains <span class="code code_spe">*.tgz</span> backup files: <span class="code code_path">backup/backup_apache.tgz</span>, <span class="code code_path">backup/backup_config.tgz</span>, <span class="code code_path">backup/backup_mysql.tgz</span> and <span class="code code_path">backup/backup_static.tgz</span>. See <span class="code code_path">src/management/commands/backup.py</span> and <span class="code code_path">src/management/commands/restore.py</span> for usage.
            </div>
          </div>

          <hr/>
          <div class="row" id="python_cache">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 30px;">
              <h4><span class="code code_path">cache/</span></h4>
              <p>Contains cache results, <span class="code code_misc">cron</span> and <span class="code code_misc">Django</span> log files, as well as status text files.</p>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td><span class="code code_path">*.log</span></td><td>Log files for <span class="code code_misc">cron</span> and <span class="code code_misc">Django</span>.</td></tr>
                      <tr>
                        <td><span class="code code_path">stat_*.json</span></td>
                        <td>Status <span class="code code_key">JSON</span> files used for admin pages. 
                          <ul>
                            <li><span class="code code_path">cache/stat_ver.json</span> contains package versions currently installed, <span class="code code_path">cache/stat_sys.json</span> contains memory and disk capacity; used by <span class="code code_url">/admin/</span>.</li>
                            <li><span class="code code_path">cache/stat_backup.json</span> contains <span class="code code_path">data/</span> folder sizes, and <span class="code code_val">daslab</span> <span class="code code_brand">Google Drive</span> file list; used by <span class="code code_url">/admin/backup/</span>.</li>
                            <li><span class="code code_path">cache/stat_dist.json</span> contains distribution info (version tag and comments) of releases in <span class="code code_path">dist/</span>; used by <span class="code code_url">/download/</span>.</li>
                          </ul>
                        </td>
                      </tr>
                      <tr><td colspan="2" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>
            </div>
          </div>

          <hr/>
          <div class="row" id="python_config">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 30px;">
              <h4><span class="code code_path">config/</span></h4>
              <p>Contains app settings and account information. <b>Do not include these files in <span class="code code_cmd">git</span>!</b> Template files <span class="code code_path">config/*.conf.example</span> are tracked instead.</p>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td><span class="code code_path">arg.conf</span></td><td colspan="2">Default parameters for all demo runs; contains sequences, structures, demo <span class="code code_key">JOB_ID</span>, and other default parameters. Should be adapted from <span class="code code_path">arg.conf.example</span> with no change.</td></tr>
                      <tr><td><span class="code code_path">cron.conf</span></td><td colspan="2">List of <span class="code code_misc">cron</span> jobs in <span class="code code_key">JSON</span> format. See <span class="code code_misc">django-crontab</span> <a href="https://github.com/kraiz/django-crontab" target="_blank">specs&nbsp;&nbsp;<span class="glyphicon glyphicon-new-window"></span></a>. The suffix of each job is for logging into corresponding log files in <span class="code code_path">cache/</span>.</td></tr>
                      <tr><td><span class="code code_path">env.conf</span></td><td colspan="2">Server secrets! Contains database and <span class="code code_brand">Apache</span> login. See <span class="code code_misc">django-environ</span> <a href="https://github.com/joke2k/django-environ" target="_blank">specs&nbsp;&nbsp;<span class="glyphicon glyphicon-new-window"></span></a>.</td></tr>
                      <tr><td><span class="code code_path">oauth.conf</span></td><td colspan="2">Access token and account information for third-party APIs in <span class="code code_key">JSON</span> format. All vendors are under <span class="code code_val">daslab</span> <span class="code code_brand">Gmail</span> account. It also records <span class="code code_brand">AWS</span> IDs and <span class="code code_brand">Google Analytics</span> ID.</td></tr>
                      <tr><td><span class="code code_path">t47_dev.py</span></td><td colspan="2"><span class="code code_misc">Django</span> setting flags, isolated from all others. </td></tr>
                      <tr><td></td><td><span class="code code_key">IS_DEVEL</span></td><td><span class="code code_key">DEBUG</span> flag. Use <span class="code code_val">1</span> for test server, <span class="code code_val">0</span> for production.</td></tr>
                      <tr><td></td><td><span class="code code_key">IS_MAINTENANCE</span></td><td>Flag for temporary server downtime. Set to <span class="code code_val">1</span> for downtime, which returns <u>503</u> response to all urls.</td></tr>
                      <tr><td></td><td><span class="code code_key">IS_SLACK</span></td><td>Flag for using <span class="code code_brand">Slack</span> for messaging. <b>No longer used</b>, moved to <span class="code code_path">config/bot.conf</span>.</td></tr>
                      <tr><td><span class="code code_path">flow_chart.svg</span></td><td colspan="2">The architecture <span class="code code_key">SVG</span> image shown in the <a href="#django">Overview</a>. It is placed here to control access to admin only.</td></tr>
                      <tr><td colspan="3" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>
            </div>
          </div>

          <hr/>
          <div class="row" id="python_data">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 30px;">
              <h4><span class="code code_path">data/</span></h4>
              <p>Contains job results for display and download.</p>
              <ul>
                <li>Files are named by <span class="code code_key">JOB_ID</span> with prefix of <span class="code code_val">result_</span>.</li>
                <li>Results are saved to their corresponding category, from <span class="code code_path">data/1d/</span>, <span class="code code_path">data/2d/</span>, and <span class="code code_path">data/3d/</span>.</li>
                <li>Old files are removed by the <span class="code code_cmd">cleanup</span> <span class="code code_misc">Django</span> command triggered by <span class="code code_misc">cron</span>.</li>
              </ul>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td><span class="code code_path">*.html</span></td><td><span class="code code_key">HTML</span> half-pages (lower half excluding <i>Input</i> section) rendered for direct display. They are loaded for job retrieval, or waiting while a job is running.</td></tr>
                      <tr><td><span class="code code_path">*.txt</span>, <span class="code code_path">*.zip</span></td><td>Downloadable results for the user.</td></tr>
                      <tr><td><span class="code code_path">*.json</span></td><td>96-well plate layout specs for the corresponding job result in <span class="code code_key">JSON</span> format, to facilitate drawing by <span class="code code_misc">d3.js</span>.</td></tr>
                      <tr><td colspan="2" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>
            </div>
          </div>

          <hr/>
          <div class="row" id="python_dist">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 30px;">
              <h4><span class="code code_path">dist/</span></h4>
              <p>Contains <code>primerize</code> package releases for download. The meta data for all releases are stored in <span class="code code_path">cache/stat_dist.json</span>. The <span class="code code_cmd">dj_man dist</span> command automates distribution and meta data.</p>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td><span class="code code_path">Primerize-?.?.?.zip</span></td><td><code>primerize</code> package releases named after their versions.</td></tr>
                      <tr><td><span class="code code_path">Primerize-master.zip</span></td><td>The latest master branch of the <code>primerize</code> package at <span class="code code_url">https://github.com/DasLab/Primerize/</span>.</td></tr>
                      <tr><td><span class="code code_path">Primerize-LICENSE.md</span></td><td>The LICENSE statement from the <code>primerize</code> repository to be displayed at <span class="code code_url">/license/</span>.</td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>
            </div>
          </div>

          <hr/>
          <div class="row" id="python_media">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 30px;">
              <h4><span class="code code_path">media/</span></h4>
              <p>Contains front-end public files.</p>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td><span class="code code_path">admin/</span></td><td colspan="2">Admin related <span class="code code_key">HTML</span> files, as well as images (because of relative path used by <span class="code code_misc">Django</span> admin and <span class="code code_misc">django-filemanager</span> apps).</td></tr>
                      <tr><td></td><td><span class="code code_path">base.html</span></td><td>Admin site <span class="code code_key">HTML</span> frame template.</td></tr>
                      <tr><td></td><td><span class="code code_path">img/</span></td><td>Admin site <span class="code code_key">SVG</span> and <span class="code code_misc">django-filemanager</span> icons.</td></tr>
                      <tr><td></td><td><span class="code code_path">js/</span></td><td>Admin site <span class="code code_key">JS</span> scripts.</td></tr>
                      <tr><td><span class="code code_path">css/</span></td><td colspan="2"><span class="code code_key">CSS</span> styling spreadsheet files.</td></tr>
                      <tr><td></td><td><span class="code code_path">admin.css</span></td><td>For admin site.</td></tr>
                      <tr><td></td><td><span class="code code_path">theme.css</span>, <span class="code code_path">palette.css</span>, <span class="code code_path">code.css</span></td><td>For public site; general and color schemes.</td></tr>
                      <tr><td></td><td><span class="code code_path">bootstrap.min.css</span>, <span class="code code_path">_suit.css</span>, <span class="code code_path">_filemanager.css</span></td><td>Vendor files.</td></tr>
                      <tr><td></td><td><span class="code code_path">min/</span></td><td>Folder of minified <span class="code code_key">CSS</span> files, for production only.</td></tr>
                      <tr><td><span class="code code_path">fonts/</span></td><td colspan="2">Contains <span class="code code_misc">Glyphicons</span>, and local copy of fonts used by public site: <span class="code code_spe">Helvetica</span>.</td></tr>
                      <tr><td><span class="code code_path">html/</span></td><td colspan="2"><span class="code code_key">HTML</span> tempaltes.</td></tr>
                      <tr><td></td><td><span class="code code_path">_public.html</span></td><td>Public site frame template.</td></tr>
                      <tr><td></td><td><span class="code code_path">user_login.html</span></td><td>Login page.</td></tr>
                      <tr><td></td><td><span class="code code_path">admin_*.html</span></td><td>Admin console pages.</td></tr>
                      <tr><td></td><td><span class="code code_path">error_*.html</span></td><td>Custom HTTP error pages.</td></tr>
                      <tr><td></td><td><span class="code code_path">public_*.html</span></td><td>Public site pages.</td></tr>
                      <tr><td><span class="code code_path">images/</span></td><td colspan="2">Image files. Public site images and group icons are consolidated into sprite images for fewer requests.</td></tr>
                      <tr><td></td><td><span class="code code_path">docs/</span></td><td>Images used for tutorial and protocol pages. 96-well plate images are now rendered dynamically by <span class="code code_misc">d3.js</span> using the <span class="code code_key">JSON</span> files.</td></tr>
                      <tr><td></td><td><span class="code code_path">old/</span></td><td>Previously used logos.</td></tr>
                      <tr><td colspan="3" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>

              <h4 id="python_js"><span class="code code_path">media/js/</span></h4>
              <p>Contains <span class="code code_misc">Javascript</span> files.</p>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td><span class="code code_path">*.min.js</span></td><td colspan="2">Vendor libraries (Bootstrap, jQuery, D3).</td></tr>
                      <tr><td><span class="code code_path">admin/</span></td><td colspan="2">Admin <span class="code code_misc">Javascript</span> files.</td></tr>
                      <tr><td></td><td><span class="code code_path">_*.js</span></td><td>Vendor libraries for <span class="code code_misc">django-suit</span> and <span class="code code_misc">django-filemanager</span>.</td></tr>
                      <tr><td></td><td><span class="code code_path">apache.js</span></td><td>Makes <span class="code code_key">AJAX</span> calls to <span class="code code_url">/admin/apache_stat/</span>, which passes through <span class="code code_path">src/admin.py</span> to <span class="code code_method">restyle_apache()</span> in <span class="code code_path">src/console.py</span>. The page refreshes every <u>3</u> seconds by <span class="code code_method">setTimeout()</span>.</td></tr>
                      <tr><td></td><td><span class="code code_path">aws.js</span></td><td>Uses <span class="code code_misc">gviz-api.py</span>. Makes <span class="code code_key">AJAX</span> calls to <span class="code code_url">/admin/aws_stat/</span>, which passes through <span class="code code_path">src/admin.py</span> to <span class="code code_method">aws_stats()</span> in <span class="code code_path">src/console.py</span>. Data is retrieved on the fly (not cached).</td></tr>
                      <tr><td></td><td><span class="code code_path">backup.js</span></td><td>Makes <span class="code code_key">AJAX</span> calls to <span class="code code_url">/admin/get_backup/</span>, which passes to <span class="code code_method">get_backup()</span> in <span class="code code_path">src/admin.py</span>. Also makes <span class="code code_key">AJAX</span> calls to <span class="code code_url">/admin/get_ver/</span>, which passes to <span class="code code_method">get_ver()</span> in <span class="code code_path">src/admin.py</span>.</td></tr>
                      <tr><td></td><td><span class="code code_path">doc.js</span>, <span class="code code_path">doc_cherrypy.js</span></td><td>Used by <span class="code code_url">/admin/man/</span> and <span class="code code_url">/admin/ref/</span> pages for <span class="code code_misc">scrollSpy</span> side-bar resizing according to <span class="code code_method">window.width()</span>. The obsolete <span class="code code_misc">CherryPy</span> documentation page (<span class="code code_url">/admin/doc/</span>) uses <span class="code code_path">doc_cherrypy.js</span>.</td></tr>
                      <tr><td></td><td><span class="code code_path">ga.js</span></td><td>Uses <span class="code code_misc">gviz-api.py</span>, not <span class="code code_brand">Google Analytics</span> API. Makes <span class="code code_key">AJAX</span> calls to <span class="code code_url">/admin/ga_stat/</span>, which passes through <span class="code code_path">src/admin.py</span> to <span class="code code_method">ga_stats()</span> in <span class="code code_path">src/console.py</span>. Data is retrieved on the fly (not cached).</td></tr>
                      <tr><td></td><td><span class="code code_path">git.js</span></td><td>Uses <span class="code code_misc">gviz-api.py</span>. Makes <span class="code code_key">AJAX</span> calls to <span class="code code_url">/admin/git_stat/</span>, which passes through <span class="code code_path">src/admin.py</span> to <span class="code code_method">git_stats()</span> in <span class="code code_path">src/console.py</span>. Data is retrieved on the fly (not cached).</td></tr>
                      <tr><td></td><td><span class="code code_path">home.js</span></td><td>Similar to <span class="code code_path">backup.js</span>, makes <span class="code code_key">AJAX</span> calls to <span class="code code_url">/admin/get_backup/</span> and <span class="code code_url">/admin/get_ver/</span>. Additionally, makes <span class="code code_key">AJAX</span> calls to <span class="code code_url">/admin/backup_form/</span>, which passes through <span class="code code_path">src/admin.py</span> to <span class="code code_method">get_backup_form()</span> in <span class="code code_path">src/console.py</span>; <span class="code code_url">/admin/ssl_dash/</span>, which passes through <span class="code code_path">src/admin.py</span> to <span class="code code_method">dash_ssl()</span> in <span class="code code_path">src/console.py</span>.</td></tr>
                      <tr><td></td><td><span class="code code_path">load.js</span></td><td>Loads vendor libraries using <span class="code code_spe">CDN</span>, or <b>fallback</b> to local files. Used by entire site (both public and group)! Makes <span class="code code_key">AJAX</span> call to <span class="code code_url">/get_js/</span>, which passes to <span class="code code_method">get_js()</span> in <span class="code code_path">src/views.py</span>. It checks <b>jQuery</b> availability from <span class="code code_url">https://cdnjs.com/</span> first, and decides whether to use it. Uses <span class="code code_method">document.write()</span> to dynamically add <code>&lt;script&gt;</code> and  <code>&lt;link&gt;</code> in <span class="code code_key">HTML</span>.</td></tr>
                      <tr><td></td><td><span class="code code_path">menu.js</span>, <span class="code code_path">table.js</span></td><td>Injection of <span class="code code_misc">Javascript</span> to format menu (sidebar, navbar, breadcrumb, highlighting, collapsing) and table (column width and icon for <code>&lt;th&gt;</code>, and Date/Time <code>&lt;input&gt;</code>) for admin pages. Note that the <span class="code code_method">window.resize()</span> methods use <span class="code code_method">setTimeout()</span> to prevent overlapping trigger of the event that results in delay in updating the view.</td></tr>

                      <tr><td><span class="code code_path">public/</span></td><td colspan="2">Public <span class="code code_misc">Javascript</span> files.</td></tr>
                      <tr>
                        <td></td><td><span class="code code_path">design_1d.js</span></td>
                        <td>Interactive script for <span class="code code_class">Design1D</span> job page.
                          <ul>
                            <li>Input disabling / <span class="code code_spe">re</span> filtering, sequence length tracking and warning toggle.</li>
                            <li>Form submission is replaced by <span class="code code_key">AJAX</span> <span class="code code_spe">POST</span> requests to prevent page refresh. The input values are updated from the <span class="code code_key">JSON</span> returned from the form submission, only once. The <span class="code code_key">JOB_ID</span> is assigned by <span class="code code_cmd">python</span> and returned inside the <span class="code code_key">JSON</span> response.</li>
                            <li>After submission (or demo), the <span class="code code_method">ajax_update_result()</span> function is called at most every second (depending on sequence length). This function loads the <span class="code code_key">HTML</span> file of the current <span class="code code_key">JOB_ID</span>, and keep refreshing until it's no longer the <i>"waiting"</i> page (<i>i.e.</i>, run finished with either <span class="code_path">success</span> or <span class="code_spe">error</span>). This refreshing behavior makes sure the result is updated while the run is underway, if the user stays waiting on the page.</li>
                            <li>The <span class="code code_method">ajax_load_html()</span> function handles job result retrieval when user returns with a <span class="code code_key">JOB_ID</span> after leaving the status-refreshing page.</li>
                            <li>The current window URL is updated to <span class="code code_url">/result/?job_id=</span> with the actural <span class="code code_key">JOB_ID</span> once the run finishes.</li>
                            <li>When retrieving a result after leaving the running page, the input parameters are retrieved from <span class="code code_brand">MySQL</span> and loaded in the <span class="code code_class">forms.Form</span> model by <span class="code code_method">result()</span> in <span class="code code_path">src/views.py</span>.</li>
                          </ul>
                        </td>
                      </tr>
                      <tr>
                        <td></td><td><span class="code code_path">design_2d.js</span>, <span class="code code_path">design_3d.js</span></td>
                        <td>Interactive scripts for <span class="code code_class">Design2D</span> and <span class="code code_class">Design3D</span> job pages.
                          <ul>
                            <li>The <span class="code code_key">AJAX</span> <span class="code code_spe">POST</span> form submission mechanism, page refreshing and/or loading by <span class="code code_method">ajax_update_result()</span> and <span class="code code_method">ajax_load_html()</span>, window URL rewrite are the same as <span class="code code_path">design_1d.js</span>.</li>
                            <li>Input length tracking, and appending input boxes for additional primer pairs (<span class="code code_method">expand_primer_input()</span>) and structures (<span class="code code_method">expand_structure_input()</span>).</li>
                            <li>The inherited input boxes for primer sets and structures from <span class="code code_misc">Django</span> are hidden in order to use the rich multi-input interface. The <span class="code code_method">track_primer_list()</span> and <span class="code code_method">track_structure_list()</span> functions updates the original hidden inputs on <span class="code code_misc">keyup</span> events of any of those visible input boxes. <b>The original hidden inputs are actually used for form submission.</b> And the <span class="code code_method">sync_primer_input()</span> and <span class="code code_method">sync_structure_input()</span> functions are in charge of updating those fields from the returned <span class="code code_key">JSON</span>.</li>
                            <li>Primer sets and structures are disabled upon form submission to make sure the original hidden inputs are up-to-date with the visible ones, and re-enabled right after <span class="code code_key">AJAX</span> <span class="code code_spe">POST</span>.</li>
                            <br/>
                            <li>When the page is referred by <span class="code code_method">design_2d_from_1d()</span>, <span class="code code_method">design_3d_from_1d()</span>, or <span class="code code_method">design_3d_from_2d()</span>, the pre-filled results are passed simiarly as the case of retrieving a result. This part of <span class="code code_misc">Javascript</span> code resides in <span class="code code_path">media/html/public_design_?d.html</span> since it's dependent on templating variables from <span class="code code_misc">Django</span>.</li>
                          </ul>
                        </td>
                      </tr>
                      <tr><td></td><td><span class="code code_path">index.js</span></td><td>Makes <span class="code code_key">AJAX</span> call to <span class="code code_url">/get_ver/</span> for displaying server <code>primerize</code> running version. Also handles the result retrieval button gate control; and column height consistency.</td></tr>
                      <tr>
                        <td></td><td><span class="code code_path">plate_96.js</span></td>
                        <td>Core script that handles 96-well plate drawing using <span class="code code_misc">d3.js</span>.
                          <ul>
                            <li>The <span class="code code_method">draw_96_plate()</span> function loads the corresponding <span class="code code_key">JSON</span> file for the specified <span class="code code_key">JOB_ID</span> (by default <span class="code code_key">type</span> is <span class="code code_val">2</span>, meaning <mark>2d</mark> for the path) and draw all the plates on the page with a naming scheme for <span class="code code_key">SVG</span> containers of <span class="code code_val">#svg_plt_?_prm_?</span>.</li>
                            <li>Special colors are avaiable as parsed in <span class="code code_method">get_fill_color()</span>. This is mainly used by the <span class="code code_url">/protocol/</span> page, as well as <u>Wild-Type</u> primer color override for <span class="code code_class">Design3D</span> jobs.</li>
                          </ul>
                        </td>
                      </tr>
                      <tr><td></td><td><span class="code code_path">protocol.js</span>, <span class="code code_path">tutorial.js</span></td><td><span class="code code_path">tutorial.js</span> takes care of the <span class="code code_method">window.width()</span> and <span class="code code_misc">scrollSpy</span> similarly as <span class="code code_path">media/js/admin/doc.js</span>; used by <span class="code code_url">/tutorial/</span> and <span class="code code_url">/protocol/</span>. <span class="code code_path">protocol.js</span> is responsible for the <u>DNA/RNA</u> concentration calculator and example 96-well plates rendering.</td></tr>
                      <tr><td></td><td><span class="code code_path">util.js</span></td><td>Shared by all public pages. It takes care of responsive resizing, loading animation, footer year display, and navbar menu highlighting.</td></tr>
                      <tr><td><span class="code code_path">suit/</span></td><td colspan="2">Vendor of <span class="code code_misc">django-suit</span> scripts. Only <span class="code code_path">*.min.js</span> are used.</td></tr>
                      <tr><td colspan="3" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>
            </div>
          </div>

          <hr/>
          <div class="row" id="python_src">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 30px;">
              <h4><span class="code code_path">src/</span></h4>
              <p>Contains <span class="code code_cmd">python</span> scripts for the app.</p>
              <br/>
              <h4 id="src_admin"><span class="code code_path">src/admin.py</span></h4>
              <p>Handles admin related page requests and tasks.</p>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td><span class="code code_class">class</span></td><td>Defines admin page view (list and detail), layout and field grouping. See <a href="https://docs.djangoproject.com/en/1.9/ref/contrib/admin/" target="_blank">here&nbsp;&nbsp;<span class="glyphicon glyphicon-new-window"></span></a>.</td></tr>
                      <tr><td><span class="code code_method">apache()</span>, <span class="code code_method">aws()</span>, <span class="code code_method">ga()</span>, <span class="code code_method">git()</span></td><td>Handles page requests of <span class="code code_url">/admin/apache/</span>, <span class="code code_url">/admin/aws/</span>, <span class="code code_url">/admin/ga/</span>, <span class="code code_url">/admin/git/</span>.</td></tr>
                      <tr><td><span class="code code_method">apache_stat()</span>, <span class="code code_method">aws_stat()</span>, <span class="code code_method">ga_stat()</span>, <span class="code code_method">git_stat()</span></td><td>Retrieves analytics data through <span class="code code_method">*_stats()</span> in <span class="code code_path">src/console.py</span>.</td></tr>
                      <tr><td><span class="code code_method">get_sys()</span>, <span class="code code_method">get_ver()</span>, <span class="code code_method">get_backup()</span></td><td>Accesses <span class="code code_path">cache/stat_sys.json</span>, <span class="code code_path">cache/stat_ver.json</span> and <span class="code code_path">cache/stat_backup.json</span> for <span class="code code_cmd">versions</span> and <span class="code code_cmd">backup</span> status (capacity, sizes, <i>etc.</i>) text. Neither <span class="code code_key">TXT</span> files are accessible through url.</td></tr>
                      <tr><td><span class="code code_method">get_arch()</span></td><td>Accesses <span class="code code_path">config/flow_chart.svg</span> for admin only.</td></tr>
                      <tr><td><span class="code code_method">backup_form()</span></td><td>Get backup related status from <span class="code code_misc">cron</span> jobs.</td></tr>
                      <tr><td><span class="code code_method">backup_now()</span>, <span class="code code_method">upload_now()</span></td><td>Kicks off <span class="code code_method">call_command()</span> for management commands of either <span class="code code_cmd">backup</span> or <span class="code code_cmd">gdrive</span>.</td></tr>
                      <tr><td><span class="code code_method">sys_stat()</span></td><td>Kicks off <span class="code code_method">call_command()</span> for management command of <span class="code code_cmd">versions</span>.</td></tr>
                      <tr><td><span class="code code_method">ssl_dash()</span></td><td>Returns status of <span class="code code_misc">SSL Certificate</span>.</td></tr>
                      <tr><td><span class="code code_method">backup()</span></td><td>Handles page requests of <span class="code code_url">/admin/backup/</span> page. Also takes <span class="code code_spe">POST</span> request to set configurations.</td></tr>
                      <tr><td><span class="code code_method">dir()</span>, <span class="code code_method">man()</span>, <span class="code code_method">ref()</span>, <span class="code code_method">doc()</span></td><td>Handles page requests of <span class="code code_url">/admin/dir/</span>, <span class="code code_url">/admin/man/</span>, <span class="code code_url">/admin/ref/</span>, and <span class="code code_url">/admin/doc/</span> for <span class="code code_misc">django-filemanager</span> and documentation pages.</td></tr>
                      <tr><td colspan="2" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>

              <br/>
              <h4 id="src_console"><span class="code code_path">src/console.py</span></h4>
              <p>Handles admin analytics console/dashboard data requests and error emails.</p>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td><span class="code code_method">send_notify_emails()</span></td><td colspan="2">Uses <span class="code code_cmd">smtp</span> email to send messages to admin about error reports.</td></tr>
                      <tr><td><span class="code code_method">get_backup_stat()</span></td><td colspan="2">Reads sizes of folders in <span class="code code_path">data/</span> and sizes of files in <span class="code code_path">backup/</span>, and a list of <span class="code code_key">TGZ</span> files stored in <span class="code code_brand">Google Drive</span>. Text information is saved to <span class="code code_path">cache/stat_backup.json</span>.</td></tr>
                      <tr><td><span class="code code_method">refresh_settings()</span></td><td colspan="2">Reloads <span class="code code_path">config/*.conf</span> files into current running environment. It writes to <span class="code code_class">settings._wrapped</span> to overwrite current <span class="code code_misc">Django</span> app setting.</td></tr>
                      <tr><td><span class="code code_method">get_sys_crontab()</span>, <span class="code code_method">set_sys_crontab()</span></td><td colspan="2"><b>GET</b>/<b>SET</b> <span class="code code_misc">cron</span> jobs. <b>GET</b> reads from system <span class="code code_cmd">crontab -l</span> instead of <span class="code code_path">config/cron.conf</span> to reflect the current setting.</td></tr>
                      <tr><td><span class="code code_method">get_backup_form()</span>, <span class="code code_method">set_backup_form()</span></td><td colspan="2"><b>GET</b>/<b>SET</b> <span class="code code_cmd">backup</span> settings. <b>GET</b> reads from system <span class="code code_method">get_sys_crontab()</span>; <b>SET</b> writes to <span class="code code_path">config/cron.conf</span>.</tr>
                      <tr><td><span class="code code_method">restyle_apache()</span></td><td colspan="2">Parses <span class="code code_brand">Apache</span> status page (<span class="code code_url">/server-status/</span>) into a <span class="code code_key">JSON</span> object. Uses <span class="code code_misc">urllib2</span> for credential supply to <span class="code code_url">/server-status/</span>.</td></tr>

                      <tr><td><span class="code code_method">aws_stats()</span></td><td colspan="2">Handles <span class="code code_url">/admin/aws/</span> data query. Uses <span class="code code_misc">gviz-api.py</span> and <span class="code code_misc">boto</span>. Calls <span class="code code_method">aws_result()</span> through <span class="code code_method">aws_call()</span> for data formatting. <span class="code code_key">qs</span>=<span class="code code_val">init</span> returns <span class="code code_key">JSON</span>, while others return <span class="code code_brand">Google Visualization</span> <span class="code code_method">ToJSONResponse()</span> object. Query format:</td></tr>
                      <tr><td></td><td><span class="code code_key">qs</span></td><td>Query string; accepts <span class="code code_val">init</span> (table of basic specs on top of page), <span class="code code_val">latency</span>, <span class="code code_val">request</span>, <span class="code code_val">23xx</span> (HTTP response <u>2xx</u> and <u>3xx</u> combined), <span class="code code_val">45xx</span> (HTTP response <u>4xx</u> and <u>5xx</u> combined), <span class="code code_val">host</span>, <span class="code code_val">status</span>, <span class="code code_val">cpu</span>, <span class="code code_val">credit</span>, and <span class="code code_val">volbytes</span>.</td></tr>
                      <tr><td></td><td><span class="code code_key">sp</span></td><td>Period; accepts <span class="code code_val">7d</span> (7 days) or <span class="code code_val">48h</span> (48 hours).</td></tr>
                      <tr><td></td><td><span class="code code_key">tqx</span></td><td>Required by <span class="code code_brand">Google Visualization</span> API. It should has the value like <span class="code code_val">reqId:%d</span>.</tr></td>
                      <tr><td><span class="code code_method">ga_stats()</span></td><td colspan="2">Handles <span class="code code_url">/admin/ga/</span> data query. Uses <span class="code code_misc">gviz-api.py</span>. Uses <span class="code code_misc">requests</span> instead of <span class="code code_brand">Google Analytics</span> <b>OAuth</b> API for simplicity. <span class="code code_key">qs</span>=<span class="code code_val">init</span> returns <span class="code code_key">JSON</span>, while others return <span class="code code_brand">Google Visualization</span> <span class="code code_method">ToJSONResponse()</span> object. Makes <u>3</u> attempts if connection fails. Query format:</td></tr>
                      <tr><td></td><td><span class="code code_key">qs</span></td><td>Query string; accepts <span class="code code_val">init</span> (table of number ratings), <span class="code code_val">chart</span> (session plots), <span class="code code_val">pie</span> (categorical pie plots), and <span class="code code_val">geo</span> (world map of visitors).</td></tr>
                      <tr><td></td><td><span class="code code_key">sp</span></td><td>Period or type; <span class="code code_key">qs</span>=<span class="code code_val">chart</span> accepts <span class="code code_val">24h</span>, <span class="code code_val">7d</span>, <span class="code code_val">1m</span> (1 month), or <span class="code code_val">3m</span> (3 months), while <span class="code code_key">qs</span>=<span class="code code_val">pie</span> accepts <span class="code code_val">session</span>, <span class="code code_val">user</span>, <span class="code code_val">browser</span>, or <span class="code code_val">pageview</span>.</td></tr>
                      <tr><td></td><td><span class="code code_key">tqx</span></td><td>Same as in <span class="code code_method">aws_stats()</span>.</tr></td>
                      <tr><td><span class="code code_method">git_stats()</span></td><td colspan="2">Handles <span class="code code_url">/admin/git/</span> data query. Uses <span class="code code_misc">gviz-api.py</span> and <span class="code code_misc">PyGithub</span>. <span class="code code_key">qs</span>=<span class="code code_val">init</span> returns <span class="code code_key">JSON</span>, while others return <span class="code code_brand">Google Visualization</span> <span class="code code_method">ToJSONResponse()</span> object. Makes <u>3</u> attempts if connection fails. Query format:</td></tr>
                      <tr><td></td><td><span class="code code_key">qs</span></td><td>Query string; accepts <span class="code code_val">init</span> (table of contributors data), <span class="code code_val">num</span> (repository statistics, e.g. number of branches), <span class="code code_val">c</span> (commits calendar), <span class="code code_val">ad</span> (addition/deletion timeline), and <span class="code code_val">au</span> (author contribution pie plot).</td></tr>
                      <tr><td></td><td><span class="code code_key">tqx</span></td><td>Same as in <span class="code code_method">aws_stats()</span>.</tr></td>
                      <tr><td><span class="code code_method">dash_ssl()</span></td><td colspan="2">Uses <span class="code code_cmd">openssl</span> to retrieve server <span class="code code_misc">SSL Certificate</span> expiration date.</td></tr>
                      <tr><td colspan="3" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>

              <br/>
              <h4 id="src_env"><span class="code code_path">src/env.py</span></h4>
              <p>Handles <span class="code code_spe">*.conf</span> files and <span class="code code_key">HTML</span> template path.</p>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td><span class="code code_class">SYS_PATH</span></td><td>Collection of <span class="code code_key">HTML</span> template path and data folder path.</td></tr>
                      <tr><td><span class="code code_method">reload_conf()</span></td><td>Loads <span class="code code_path">config/*.conf</span> files and save as runtime environment variables for the <span class="code code_misc">Django</span> app.</td></tr>
                      <tr><td><span class="code code_method">error400()</span>, <span class="code code_method">error401()</span>, <span class="code code_method">error403()</span>, <span class="code code_method">error404()</span>, <span class="code code_method">error500()</span>, <span class="code code_method">error503()</span></td><td>Handlers for custom HTTP error response pages. Use <span class="code code_url">?status=false</span> to suppress the HTTP error code (returns <u>200</u> instead).</td></tr>
                      <tr><td colspan="2" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>

              <br/>
              <h4 id="src_helper"><span class="code code_path">src/helper.py</span></h4>
              <p>Collection of helper functions for <span class="code code_path">src/wrapper_?d.py</span>.</p>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td><span class="code code_val">prm_1d</span>, <span class="code code_val">prm_2d</span>, <span class="code code_val">prm_3d</span></td><td><code>primerize</code> constructor instances. They are constructed once and shared by <span class="code code_path">src/wrapper_?d.py</span>.</td></tr>
                      <tr><td><span class="code code_method">is_valid_name()</span>, <span class="code code_method">is_valid_email()</span>, <span class="code code_method">is_t7_present()</span></td><td>Test functions for inputs.</td></tr>
                      <tr><td><span class="code code_method">random_job_id()</span></td><td>Generates random <span class="code code_key">JOB_ID</span> as <mark>16-digit</mark> <u>hexadecimal</u> string. It prevents collision by querying all previous <span class="code code_key">JOB_ID</span> on record.</td></tr>
                      <tr><td><span class="code code_method">create_res_html()</span>, <span class="code code_method">create_wait_html()</span>, <span class="code code_method">create_err_html()</span></td><td>Writes to <span class="code code_key">HTML</span> result files in <span class="code code_path">data/</span>. <span class="code code_method">create_res_html()</span> is called by the other 2 for file handling.</td></tr>
                      <tr><td colspan="2" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>

              <br/>
              <h4 id="src_models"><span class="code code_path">src/models.py</span></h4>
              <p>Handles <span class="code code_brand">MySQL</span> database table schema and in-page form models.</p>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td><span class="code code_class">models.Model</span></td><td colspan="2">Database table schema. See <a href="https://docs.djangoproject.com/es/1.9/ref/models/fields/" target="_blank">here&nbsp;&nbsp;<span class="glyphicon glyphicon-new-window"></span></a>; contains <span class="code code_class">Design1D</span>, <span class="code code_class">Design2D</span>, <span class="code code_class">Design3D</span>, <span class="code code_class">JobIDs</span>, <span class="code code_class">JobGroups</span>, <span class="code code_class">HistoryItem</span>, and <span class="code code_class">SourceDownloader</span>.</td></tr>
                      <tr><td><span class="code code_class">forms.Form</span></td><td colspan="2">Front-end in-page forms. See <a href="https://docs.djangoproject.com/en/1.9/ref/forms/fields/" target="_blank">here&nbsp;&nbsp;<span class="glyphicon glyphicon-new-window"></span></a>.</td></tr>
                      <tr><td></td><td>Admin site</td><td><span class="code code_class">BackupForm</span>.</td></tr>
                      <tr><td></td><td>Public site</td><td><span class="code code_class">Design1DForm</span>, <span class="code code_class">Design2DForm</span>, <span class="code code_class">Design3DForm</span>, and <span class="code code_class">DownloadForm</span>.</td></tr>
                      <tr><td></td><td>Login</td><td><span class="code code_class">LoginForm</span>, <span class="code code_class">PasswordForm</span>.</td></tr>
                      <tr><td><span class="code code_method">debug_flag()</span>, <span class="code code_method">ga_tracker()</span></td><td colspan="2">Global context processors to convey <span class="code code_key">DEBUG</span> flag and <span class="code code_brand">Google Analytics</span> tracker ID.</td></tr>
                      <tr><td colspan="3" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>

              <br/>
              <h4 id="src_settings"><span class="code code_path">src/settings.py</span></h4>
              <p>Handles basic app settings (defined by <span class="code code_misc">Django</span>). See <a href="https://docs.djangoproject.com/en/1.9/ref/settings/" target="_blank">here&nbsp;&nbsp;<span class="glyphicon glyphicon-new-window"></span></a>. <b>Loading order is to avoid <span class="code code_method">import</span> loop.</b></p>
              <ul>
                <li><span class="code code_key">X_FRAME_OPTIONS</span> is not set to <span class="code code_val">DENY</span> due to <span class="code code_url">/admin/dir/</span> uses <code>&lt;iframe&gt;</code> of <span class="code code_url">/admin/browse/</span>.</li>
              </ul>

              <br/>
              <h4 id="src_urls"><span class="code code_path">src/urls.py</span></h4>
              <p>Handles url routing (defined by <span class="code code_misc">Django</span>). Uses <span class="code code_class">AdminSitePlus()</span> to override <span class="code code_class">Admin</span>. See <span class="code code_misc">django-adminplus</span> <a href=" https://github.com/jsocol/django-adminplus/" target="_blank">here&nbsp;&nbsp;<span class="glyphicon glyphicon-new-window"></span></a>.</p>
              <ul>
                <li>Routes <span class="code code_url">/site_media/</span> to <span class="code code_path">media/</span>, and <span class="code code_url">/site_data/</span> to <span class="code code_path">data/</span>; to prevent direct access to files from path.</li>
                <li>Redirect old and synonym urls to current ones with <u>301</u>. Exposes custom error handler pages, as well as <span class="code code_path">robots.txt</span> as <span class="code code_url">/robots.txt</span>.</li>
                <li>Based on <span class="code code_key">IS_MAINTENANCE</span> in <span class="code code_path">config/t47_dev.py</span>, the server can run in either <b>normal</b> mode or <b>downtime</b> mode. In <b>downtime</b> mode, all requests are responded with HTTP code <u>503</u>.</li>
              </ul>

              <br/>
              <h4 id="src_views"><span class="code code_path">src/user.py</span></h4>
              <p>Handles responses for user-related activity. Each handler is routed from <span class="code code_path">src/urls.py</span>, and takes <span class="code code_class">PATH.HTML_PATH</span> to locate <span class="code code_key">HTML</span> templates</p>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td><span class="code code_method">user_login()</span>, <span class="code code_method">user_password()</span>, <span class="code code_method">user_logout()</span></td><td>Pages related to account. Only used in <b>test server</b> due to <span class="code code_misc">WebAuth</span>. In production, the only user in system is <span class="code code_val">daslab</span>.</td></tr>
                      <tr><td><span class="code code_method">browse()</span></td><td><span class="code code_misc">django-filemanger</span> view handler, channeled as <code>&lt;iframe&gt;</code> on <span class="code code_url">/admin/dir/</span>.</td></tr>
                      <tr><td colspan="2" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>

              <br/>
              <h4 id="src_views"><span class="code code_path">src/views.py</span></h4>
              <p>Handles responses for non-admin pages. Each handler is routed from <span class="code code_path">src/urls.py</span>, and mostly takes <span class="code code_class">PATH.HTML_PATH</span> to locate <span class="code code_key">HTML</span> templates</p>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td><span class="code code_method">index()</span>, <span class="code code_method">tutorial()</span>, <span class="code code_method">protocol()</span>, <span class="code code_method">docs()</span>, <span class="code code_method">about()</span></td><td>Page handlers for corresponding URLs. Some pass additional information for page rendering or dynamic contents.</td></tr>
                      <tr><td><span class="code code_method">license()</span></td><td>Handler for <span class="code code_url">/license/</span> page. Reads in <span class="code code_path">dist/Primerize-LICENSE.md</span> for display.</td></tr>
                      <tr><td><span class="code code_method">download()</span></td><td>Handler for <span class="code code_url">/download/</span> page and form. It displays all available releases of <code>primerize</code> based on information from <span class="code code_path">cache/stat_dist.json</span>. For valid registration, it writes to a <span class="code code_class">SourceDownloader</span> entry and passes the demographic information back, which is useful for <span class="code code_method">link()</span>.</td></tr>
                      <tr><td><span class="code code_method">link()</span></td><td>Handler for direct <code>primerize</code> code download responses. This is a mechanism for preventing direct access/exposure of <span class="code code_path">dist/Primerize-?.?.?.zip</span> files. Requests are validated against <span class="code code_class">SourceDownloader</span> records, and the <span class="code code_key">ZIP</span> file is returned only when a match is found.</td></tr>
                      <tr><td><span class="code code_method">result()</span></td><td>Handler for result retrieval. It looks up the <span class="code code_key">JOB_ID</span> in <span class="code code_class">JobIDs</span> for a match, and responses with a page for the corresponding <span class="code code_class">Design?D</span> type. Input values of the found <span class="code code_key">JOB_ID</span> record is populated to the <span class="code code_class">form</span> as <i>initial</i> values.</td></tr>
                      <tr><td><span class="code code_method">ping_test()</span></td><td>Returns an empty <u>200</u> response. Used by <span class="code code_brand">AWS</span> <span class="code code_misc">ELB</span> <b>Health Check</b>.</td></tr>
                      <tr><td><span class="code code_method">test()</span></td><td>Test handler for <b>test server</b>. Not accessible in production.</td></tr>
                      <tr><td><span class="code code_method">get_admin()</span>, <span class="code code_method">get_user()</span></td><td>Used by <u>403</u> error page only (<span class="code code_url">/error/403/</span>).</td></tr>
                      <tr><td><span class="code code_method">get_js()</span></td><td>Used by <span class="code code_path">media/js/admin/load.js</span>. Reads <span class="code code_path">cache/stat_ver.json</span> and returns core <span class="code code_key">JS</span> vendor library versions. The versions information is used to load libraries from <span class="code code_spe">CDN</span>.</td></tr>
                      <tr><td><span class="code code_method">get_ver()</span></td><td>Used by <span class="code code_url">/</span> and <span class="code code_url">/docs/</span> to retrieve current running version <code>primerize</code>.</td></tr>
                      <tr><td colspan="2" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>

              <br/>
              <h4 id="src_wsgi"><span class="code code_path">src/wsgi.py</span></h4>
              <p>Handles <span class="code code_misc">uwsgi</span> connections. <b>Do not change</b>, unless syntax changes in newer <span class="code code_misc">Django</span> releases. Called by <span class="code code_brand">Apache</span> <span class="code code_misc">mod_wsgi</span> dispatcher.</p>
            </div>
          </div>

          <hr/>
          <div class="row" id="python_wrap">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 30px;">
              <h4><span class="code code_path">src/wrapper_?d.py</span></h4>
              <p>Handles design run submissions.</p>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr><td><span class="code code_method">design_?d()</span></td><td>Presents the empty design page.</td></tr>
                      <tr>
                        <td><span class="code code_method">design_?d_run()</span></td>
                        <td>Handles the <span class="code code_key">AJAX</span> <span class="code code_spe">POST</span> request.
                          <ul>
                            <li>It parses and tests the inputs, spawns a job in background using <span class="code code_class">threading.Thread</span>, and adds <span class="code code_key">JOB_ID</span> to database.</li>
                            <li>It creates a <i>waiting</i> page <span class="code code_key">HTML</span> for display.</li>
                            <li> A <span class="code code_key">JSON</span> response is returned for page refreshing, while the threaded job runs in parallel.</li>
                          </ul>
                        </td>
                      </tr>
                      <tr><td><span class="code code_method">demo_?d()</span></td><td>Presents the demo result page.</td></tr>
                      <tr><td><span class="code code_method">demo_?d_run()</span></td><td>Handles the <span class="code code_key">AJAX</span> <span class="code code_spe">POST</span> request for running demo. It takes default parameter and spawns the <span class="code code_class">threading.Thread</span> job.</td></tr>
                      <tr><td><span class="code code_method">random_?d()</span></td><td>is to test for random input and remains unknown to public. It generates a random sequence first, and follow the same steps as other jobs.</td></tr>
                      <tr>
                        <td><span class="code code_method">design_?d_wrapper()</span></td>
                        <td>Calls <code>primerize</code> design code and processes the result.
                          <ul>
                            <li>It creates a <i>error</i>, or <i>fail</i>, or <i>success</i> page <span class="code code_key">HTML</span> for display, overwriting the previous <i>waiting</i> page.</li>
                            <li>It renders a graphical <span class="code code_key">HTML</span> result page by parsing the result instance from <code>primerize</code>.</li>
                            <li>It updates the <span class="code code_key">JOB_ID</span> entry in <span class="code code_brand">MySQL</span> of its <span class="code code_key">status</span>, <span class="code code_key">time</span> and results.</li>
                          </ul>
                          For <mark>2D</mark> and <mark>3D</mark>:
                          <ul>
                            <li>The result folder is zipped using <span class="code code_misc">zipfile</span> in <span class="code code_cmd">python</span>.</li>
                            <li>A <span class="code code_key">JSON</span> file is saved for <span class="code code_misc">d3.js</span> 96-well plate drawing. <u>Wild-Type</u> primers are overridden by color <i>green</i>.</li>
                          </ul>
                        </td>
                      </tr>
                      <tr><td><span class="code code_method">design_?d_from_?d()</span></td><td>Like <span class="code code_url">/result/</span>, it pre-fills the form with previous inputs, and redirects to <span class="code code_method">design_?d()</span> with flag <span class="code code_key">from_?d</span> set. The <span class="code code_key">HTTP_REFERER</span> in the <span class="code code_class">request.META</span> is required to parse <span class="code code_key">JOB_ID</span>.</td></tr>
                      <tr><td colspan="2" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>

            </div>
          </div>

          <hr/>
          <div class="row" id="man_cmd">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 30px;">
              <h4><span class="code code_path">src/management/commands</span></h4>
              <p>Contains <span class="code code_misc">Django</span> management command scripts.</p>
              <div class="row">
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
                <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                  <table class="table table-hover">
                    <tbody>
                      <tr>
                        <td><span class="code code_path">backup.py</span></td>
                        <td>
                          <ul>
                            <li>Backs up <span class="code code_misc">static</span> files, <span class="code code_brand">MySQL</span>, <span class="code code_brand">Apache</span>, and local <span class="code code_path">config/</span> files into <span class="code code_path">backup/</span> folder.</li>
                            <li>Uses <span class="code code_method">subprocess.check_call()</span> for <span class="code code_cmd">mysqldump</span>, <span class="code code_misc">tarfile</span> for creating <span class="code code_key">TGZ</span> files.</li>
                            <li>Due to lack of permissions of <span class="code code_val">www-data</span> user to <span class="code code_path">/etc/apache2/</span>, <span class="code code_brand">Apache</span> settings are archived by a <span class="code code_misc">cron</span> job under <span class="code code_val">ubuntu</span>. </li>
                            <li>The <span class="code code_misc">cron</span> job is triggered <u>weekly</u>. <b>Summary</b> is sent to admin after job finish either via <b>email</b> or <span class="code code_brand">Slack</span>. </li>
                          </ul>
                        </td>
                      </tr>
                      <tr>
                        <td><span class="code code_path">cleanup.py</span></td>
                        <td>
                          <ul>
                            <li>Finds all <span class="code code_key">JOB_ID</span> records in <span class="code code_class">JobIDs</span> table that are older than <span class="code code_key">KEEP_JOB</span> months specified in <span class="code code_path">config/cron.conf</span>.</li>
                            <li>Removes related result files in <span class="code code_path">data/</span> and deletes the <span class="code code_brand">MySQL</span> entry.</li>
                          </ul>
                        </td>
                      </tr>
                      <tr>
                        <td><span class="code code_path">dist.py</span></td>
                        <td>
                          <ul>
                            <li>Retrieves all releases of <code>primerize</code> package, and writes versions and texts into <span class="code code_path">cache/stat_dist.json</span>.</li>
                            <li>Downloads all release <span class="code code_key">ZIP</span> files using <span class="code code_cmd">curl</span> with <span class="code code_val">daslab-admin</span> <span class="code code_brand">GitHub</span> account credentials in <span class="code code_path">config/oauth.conf</span>. Files are saved to <span class="code code_path">dist/</span>. Releases already downloaded are skipped.</li>
                            <li>The latest master branch is downloaded as <span class="code code_path">dist/Primerize-master.zip</span>. The <span class="code code_path">LICENSE.md</span> inside it is extracted and placed as <span class="code code_path">dist/Primerize-LICENSE.md</span>, which is used by <span class="code code_method">license()</span> in <span class="code code_path">src/views.py</span> for <span class="code code_url">/license/</span>.</li>
                          </ul>
                        </td>
                      </tr>
                      <tr>
                        <td><span class="code code_path">gdrive.py</span></td>
                        <td>
                          <ul>
                            <li>Uploads most recent backup onto <span class="code code_val">daslab</span> <span class="code code_brand">Google Drive</span> and cleans up obsolete backup files.</li>
                            <li>Uses <span class="code code_method">subprocess.check_call()</span> for <span class="code code_cmd">drive</span>. Files are renamed with <u>date</u> as prefix.</li>
                            <li>Old files are determined by their <b>last modified date</b> and removed (default <u>45</u> days).</li>
                            <li>The <span class="code code_misc">cron</span> job is triggered <u>weekly</u>. <b>Summary</b> is sent to admin after job finish either via <b>email</b> or <span class="code code_brand">Slack</span>. </li>
                          </ul>
                        </td>
                      </tr>
                      <tr>
                        <td><span class="code code_path">restore.py</span></td>
                        <td>
                          <ul>
                            <li>Restores <span class="code code_misc">static</span> files, <span class="code code_brand">MySQL</span>, <span class="code code_brand">Apache</span>, and local <span class="code code_path">config/</span> files from local <span class="code code_path">backup/</span> files.</li>
                            <li>Uses <span class="code code_method">subprocess.check_call()</span> for <span class="code code_cmd">mysql</span>, <span class="code code_misc">tarfile</span> and <span class="code code_misc">shutil</span> for unpacking <span class="code code_key">TGZ</span> files.</li>
                          </ul>
                        </td>
                      </tr>
                      <tr>
                        <td><span class="code code_path">versions.py</span></td>
                        <td>
                          <ul>
                            <li>Collects system installed package versions into <span class="code code_path">cache/stat_sys.json</span> and <span class="code code_path">cache/stat_ver.json</span>.</li>
                            <li>Uses <span class="code code_method">subprocess.Popen()</span> for <span class="code code_cmd">bash</span> commands. Some commands need to write to <span class="code code_path">cache/temp.txt</span> temporarily for output handling. Some values, e.g. <span class="code code_misc">mod_wsgi</span>, are implemented for <u>production</u> only. Commands for <b>memory</b> readings are dependent on <span class="code code_key">DEBUG</span> as well.</li>
                            <li>Renders <span class="code code_path">cache/sys_ver.txt</span> (only in <b>production</b>) based on information in <span class="code code_path">cache/stat_ver.json</span>. It is displayed in <span class="code code_cmd">bash</span> upon login.</li>
                            <li>Calls <span class="code code_method">get_backup_stat()</span> from <span class="code code_path">src/console.py</span> too.</li>
                          </ul>
                        </td>
                      </tr>
                      <tr><td colspan="2" style="padding:0px;"></td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-lg-1 col-md-1 hidden-sm hidden-xs"></div>
              </div>
            </div>
          </div>


        </div>
      </div>
    </div>


  </div>

  <a href="#content-main" id="top" style="z-index:2000;">
    <div style="position:fixed; display:block; right:-5%; bottom:100px; opacity:0.85; z-index:2000; width:60px; height:60px;"><i class="nav_top"></i></div>
  </a>
</div>
{% endblock %}

{% block extrajs %}
  <script type="text/javascript">
    $(document).ready(function() {
      $("ul.breadcrumb").append('<li class="active"><span style="color: #000;" class="glyphicon glyphicon-briefcase"></span>&nbsp;&nbsp;Reference</li>');
    });
  </script>
  <script type="text/javascript" src="/site_media/js/admin/{{DEBUG_DIR}}doc{{DEBUG_STR}}.js"></script>
{% endblock %}
